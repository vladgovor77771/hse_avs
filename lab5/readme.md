# Лабораторная работа 5

## Условие задачи

Вариант 19.

Задача о магазине - 2 (забывчивые покупатели). В магазине работают два отдела, каждый отдел обладает уникальным ассортиментом. В каждом отделе работает один продавец. В магазин ходят исключительно забывчивые покупатели, поэтому каждый покупатель носит с собой список товаров, которые желает купить. Покупатель приобретает товары точно в том порядке, в каком они записаны в его списке. Продавец может обслужить только одного покупателя за раз. Покупатель, вставший в очередь, засыпает пока не дойдет до продавца. Продавец засыпает, если в его отделе нет покупателей, и просыпается, если появится хотя бы один. Создать многопоточное приложение, моделирующее работу магазина.

## Модель магазина

Имеется `s = 2` пронумерованных торговца (первый, второй), каждый продает по `a` товаров.

Перед каждым торговцем имеется очередь из клиентов. Скорость обработки клиента случайна в некотором диапазоне.

Каждые `n` миллисекундсекунд (или рандомно в диапазоне) в магазин заходит клиент. У него с собой "список товаров" - множество, состоящее из чисел `k*s`, где `k` от 1 до `a`. Соответственно максимальный размер равен `a*s`.

Примем, что если клиент идет в магазин, значит 100%, что он зайдет хотя бы к одному торговцу. Значит минимальный размер "списка покупок" равен 1.

Длительность эксперимента `t` секунд.

## Типы потоков

Каждый торговец - поток, обрабатывающий свою очередь.

Каждый покупатель - поток. Он решает в какую очередь встать или ждет, пока его обработают.

Поток, который создает клиентов и запускает их в магазин.

?? Поток, который все логгирует.

## Мьютексы

Так как у нас очередь, нам в любом случае придется добавить какой-то thread-safety механизм. https://stackoverflow.com/questions/36762248/why-is-stdqueue-not-thread-safe

Мьютексы это очень плохо, но от них никуда не деться в такой модели.

Лочим мьютекс, когда совершаем любую операцию с очередью.

## "Спать пока не"

Можно было сделать цикл (проверка условия, сон). А можно заюзать `std::condition_variable`.
